===============================================================================
                    AgencyManager Pro - Project Story
                    Last Updated: 2026-02-15
===============================================================================

OVERVIEW
--------
AgencyManager Pro is a CRM/Dashboard system for managing a digital marketing
agency. Built for a user who runs an agency as a self-employed business while
also being salaried. The app tracks clients, leads, deals, expenses, debts,
and provides financial dashboards.

Tech: React 19 + Vite + TypeScript + Supabase + React Router (HashRouter)
UI: Tailwind CSS via CDN, Heebo font, dark theme, RTL Hebrew layout
Hosting: GitHub -> Vercel (auto-deploy)

===============================================================================
SESSION 1 (2026-02-14) - Audit & Bug Fixes
===============================================================================

WHAT HAPPENED:
User asked to investigate the codebase for broken/problematic things.
Full audit was performed, identifying 19 issues across 4 severity levels.

ISSUES FOUND & FIXED:
1. [CRITICAL] `any` types everywhere -> Created proper DB row interfaces
   (ClientRow, LeadRow, DealRow, ExpenseRow, PaymentRow, SettingsRow)
2. [CRITICAL] JSON.parse without try-catch -> Created `safeJsonParse` helper
3. [CRITICAL] Non-atomic convertLeadToClient -> Added rollback on failure
4. [HIGH] Debug console.logs in supabaseClient.ts -> Removed
5. [HIGH] STORAGE_KEY dead code in constants.ts -> Removed
6. [HIGH] No error feedback to user -> Added error/clearError to DataContext,
   error toast in Dashboard
7. [HIGH] `isLoaded` not exposed from context -> Added to DataContextType
8. [MEDIUM] Native confirm() dialogs -> Styled Modal confirmations in
   Clients.tsx, Leads.tsx, Debts.tsx
9. [MEDIUM] Missing custom-scrollbar CSS class -> Added to index.html <style>
10. [MEDIUM] RTL margin issues (ml/mr) -> Fixed to logical ms/me in Button.tsx
11. [MEDIUM] Modal z-index conflict with sidebar -> z-50 -> z-[60]
12. [MEDIUM] Accessibility: Added role, aria-modal, aria-label to Modal.tsx
13. [MEDIUM] Accessibility: Added aria-labels to Layout.tsx sidebar buttons
14. [MEDIUM] Login.tsx responsive issues -> Fixed width/padding
15. [MEDIUM] Login.tsx mixed Hebrew/English text -> Unified
16. [MEDIUM] Settings.tsx RTL toggle animation -> Fixed translate direction
17. [MEDIUM] Settings.tsx missing FileReader.onerror -> Added
18. [MEDIUM] Settings.tsx typo "דרוס" -> "דורס"
19. [LOW] Typed all component props (KPICardProps, SidebarItemProps)

FILES MODIFIED:
- lib/supabaseClient.ts (removed debug logs)
- constants.ts (removed STORAGE_KEY)
- contexts/DataContext.tsx (major rewrite: types, error handling, async)
- components/ui/Modal.tsx (z-index, accessibility)
- components/ui/Button.tsx (RTL fix)
- components/Login.tsx (responsive, accessibility, text)
- components/Settings.tsx (RTL toggle, error handling, typo)
- components/Layout.tsx (typed props, aria-labels)
- components/Dashboard.tsx (typed props, error toast, LucideIcon)
- components/Clients.tsx (confirm delete modal)
- components/Leads.tsx (confirm convert modal)
- components/Debts.tsx (confirm delete modal, aria-labels)
- index.html (custom-scrollbar CSS)

DELETED:
- agencymanager-pro/agencymanager-pro/ (duplicate nested directory)

Build verified: `npm run build` succeeded.
Committed: 443c937 - "Fix 19 audit issues..."
Pushed to GitHub -> Vercel auto-deployed.

===============================================================================
SESSION 2 (2026-02-14) - 9 Feature Upgrades ✅ COMPLETED
===============================================================================

USER REQUESTED 9 NEW FEATURES (everything except PDF reports):

FEATURE 1: Israel Tax Calculator
- User is salaried (20K/month) + self-employed (agency income)
- Calculate net income after Israeli tax brackets + Bituach Leumi
- Display: KPI card in Dashboard + collapsible breakdown + dedicated page
- Tax brackets 2025-2026 (frozen): 10%/14%/20%/31%/35%/47%/50%
- Credit points: 2.25 x 242 = 544.50 NIS/month
- BL self-employed: 9.07% (up to 7,522) / 22.83% (7,523-49,030)
- Store employeeSalary in AgencySettings
- New files: utils/taxCalculator.ts, components/TaxCalculator.tsx

FEATURE 2: Multi-User Role System
- Admin (owner) sees everything
- Viewer (freelancers) sees: their own leads + mini dashboard
- Supabase table: user_roles (user_id, role, display_name)
- Add created_by to leads table
- New file: contexts/AuthContext.tsx
- Conditional sidebar, route gating, user management in Settings

FEATURE 3: Fix YoY Growth
- Dashboard.tsx line 73 has hardcoded `mrrChangePercent = 10`
- Replace with actual calculation using calculateMRRForMonth()

FEATURE 4: Notification Badges
- Red dot/counter on sidebar items
- "לידים" shows overdue leads count
- "חובות לקוחות" shows unpaid debts count

FEATURE 5: Edit/Delete Expenses
- Currently only addExpense exists
- Add updateExpense/deleteExpense to DataContext
- Add edit/delete UI in Expenses.tsx (follow Debts.tsx pattern)

FEATURE 6: Auto-Generate Monthly Debts
- Button to auto-create payment records for all active clients
- Based on monthlyRetainer, prevents duplicates

FEATURE 7: Client Profile Page
- /clients/:clientId route
- Shows contact info, financials, deals, expenses, payments history

FEATURE 8: Global Search (Ctrl+K)
- Command palette searching across clients, leads, deals
- Keyboard navigation, grouped results

FEATURE 9: Activity Log
- Track CRUD operations in Supabase activity_log table
- Show recent activity in Dashboard

COMPLETED FEATURES LOG:
- Feature 3 ✅: Fixed YoY Growth - replaced hardcoded 10% with actual calculation
- Feature 5 ✅: Edit/Delete Expenses - full CRUD in Expenses.tsx + DataContext
- Feature 1 ✅: Israel Tax Calculator - utils/taxCalculator.ts + TaxCalculator.tsx
  + Dashboard KPI + collapsible panel + Settings employee salary input
- Feature 6 ✅: Auto-Generate Monthly Debts - generateMonthlyPayments in DataContext
- Feature 4 ✅: Notification Badges - overdue leads + unpaid debts in sidebar
- Feature 7 ✅: Client Profile Page - /clients/:clientId with full history
- Feature 8 ✅: Global Search (Ctrl+K) - CommandPalette.tsx searching all entities
- Feature 9 ✅: Activity Log - logActivity in DataContext + ActivityLog.tsx in Dashboard
- Feature 2 ✅: Multi-User Role System - AuthContext.tsx, role-gated sidebar,
  viewer mini dashboard, filtered leads, user management in Settings

===============================================================================
SESSION 3 (2026-02-14) - Theme Toggle, Viewer Fix, Client File Uploads
===============================================================================

WHAT HAPPENED:
- Added dark/light theme toggle to Dashboard
- Fixed viewer role not being applied correctly
- Added client file uploads (contracts/documents) to ClientProfile
- Storage bucket "contracts" for Supabase Storage with RLS

===============================================================================
SESSION 4 (2026-02-14) - Retainer History, Advanced Roles, RLS, User Sync
===============================================================================

WHAT HAPPENED:
- Retainer change history tracking (retainer_changes table)
- Advanced page-level permissions for viewer roles (page_permissions JSON)
- Full RLS policies for all tables in supabase-migrations.sql
- User sync fix: match by email for pre-created viewers, then update user_id
- UUID casting fix in RLS policies (user_id is uuid type, not text)

===============================================================================
SESSION 5 (2026-02-14) - Edge Function, Lead Visibility, Enhanced CRM
===============================================================================

WHAT HAPPENED:
User wanted admin to create user accounts directly from CRM instead of
self-registration. Also reported viewer seeing empty system and no leads.
Then requested major CRM enhancements for client management.

CHANGES:

1. EDGE FUNCTION FOR USER CREATION
   - User explicitly rejected self-registration approach
   - Created `supabase/functions/create-user/index.ts` (Deno Edge Function)
   - Verifies caller is authenticated admin via user_roles table
   - Uses service_role key to call supabase.auth.admin.createUser()
   - Auto-confirms email, creates user_roles entry
   - AuthContext.tsx addViewer() now calls Edge Function
   - Settings.tsx: 3-column form (name, email, password) for adding users
   - Login.tsx: removed self-registration, only login + forgot password
   - Deployed via: npx supabase functions deploy create-user --project-ref rxckkozbkrabpjdgyxqm
   - Committed: 6925a1a

2. LEAD VISIBILITY FIX
   - Problem: Viewer (Natalie) saw empty system, no leads despite having permission
   - Root cause (dual layer):
     a) RLS policy restricted to admin OR created_by = auth.uid()
     b) Frontend filter: leads.filter(l => l.createdBy === user.id)
   - Fix: Changed both to allow all authenticated users to see all leads
   - RLS: leads_select USING (true)
   - Frontend: const visibleLeads = leads (no filtering)
   - Committed: 1085824

3. ENHANCED CLIENT MANAGEMENT (CRM Upgrade)
   User requested: assigned handler, notes history, click-to-view, UX improvements.

   a) Assigned Handler (מטפל)
      - Added `assignedTo?: string` to Client interface (types.ts)
      - Added `assigned_to uuid` column to clients table
      - Dropdown in edit modal with all users from allUsers
      - Shown in table as avatar + name column
      - Shown in ClientProfile header as violet badge

   b) Client Notes History
      - New `ClientNote` interface in types.ts
      - New `client_notes` Supabase table with RLS
      - CRUD functions in DataContext: addClientNote, deleteClientNote
      - ClientProfile: textarea + send button, notes list with avatars/timestamps
      - Admin-only delete with confirmation modal

   c) Click-to-View Client Profile
      - Entire table row is clickable -> navigates to /clients/:clientId
      - Action buttons (edit/delete) stop propagation
      - Row has cursor-pointer + hover effect

   d) UX Improvements
      - Quick stats bar above client table (active count, revenue, profit, total)
      - Effort level colored dots (green/yellow/red)
      - Inline status/rating dropdowns on client profile
      - Activity timeline on profile (filtered from activity_log)
      - getRelativeTime helper for timestamp display

   FILES MODIFIED:
   - types.ts (assignedTo, ClientNote, clientNotes in AppData)
   - contexts/DataContext.tsx (ClientNoteRow, transforms, CRUD, loadData)
   - components/Clients.tsx (row click, handler column, stats bar, effort dots)
   - components/ClientProfile.tsx (notes, inline edit, activity, handler badge)
   - supabase-migrations.sql (assigned_to column, client_notes table + RLS)

   SQL MIGRATION (user needs to run):
     ALTER TABLE clients ADD COLUMN assigned_to uuid DEFAULT NULL;
     CREATE TABLE client_notes (...);
     + RLS policies for client_notes

   Committed: 0c3cea1
   Pushed to GitHub -> Vercel auto-deployed.

===============================================================================
SESSION 6 (2026-02-15) - Lead Management Upgrade + AI + Proposals
===============================================================================

WHAT HAPPENED:
Major CRM expansion: full lead profile page, call transcripts system,
AI-powered recommendations, and Canva proposal generation. Security
hardening moved API keys to server-side only.

CHANGES:

1. LEAD PROFILE PAGE (LeadProfile.tsx)
   - Full CRM view for leads (similar to ClientProfile)
   - Route: /leads/:leadId
   - Contact info, financial summary, notes history, transcripts,
     AI recommendations, WhatsApp messages, proposals
   - Lead assigned handler (assignedTo uuid)
   - Lead notes history (lead_notes table)

2. CALL TRANSCRIPTS SYSTEM
   - New `call_transcripts` table (client_id, lead_id, call_date,
     participants, transcript, summary, full_text, recording_url)
   - Manual transcript entry from profile pages
   - Audio upload -> Gemini transcription (see Session 7)

3. AI RECOMMENDATIONS
   - New Edge Function: ai-recommendations/index.ts
   - Generates actionable advice based on notes + transcripts via Gemini API
   - New `ai_recommendations` table (client_id, lead_id, recommendation)
   - Expandable recommendation cards in profile
   - Persistent storage with admin-only delete

4. CANVA PROPOSAL GENERATION
   - New Edge Function: generate-proposal/index.ts
   - Uses Canva Connect API to autofill brand template with lead data
   - Autofills: business name, client name, price, services, contact, date
   - Exports to PDF (polling for completion)
   - Returns: Canva design URL + PDF download URL

5. API KEYS SERVER-SIDE ONLY
   - Gemini API key + Canva API key stored in settings table
   - Frontend only sees boolean flags (hasGeminiKey, hasCanvaKey)
   - Edge Functions access keys via service_role client

FILES MODIFIED:
- types.ts (LeadNote, CallTranscript, AIRecommendation interfaces)
- contexts/DataContext.tsx (new CRUD: call transcripts, AI recommendations, lead notes)
- components/LeadProfile.tsx (NEW: full lead CRM profile)
- components/Leads.tsx (click-to-view, handler column)
- supabase/functions/ai-recommendations/index.ts (NEW)
- supabase/functions/generate-proposal/index.ts (NEW)
- components/Settings.tsx (API key management UI)

Commits: 89a3947, fd2946a, 67f4fa4, 6d6edbb
Pushed to GitHub -> Vercel auto-deployed.

===============================================================================
SESSION 7 (2026-02-15) - WhatsApp Messages + Audio Transcription
===============================================================================

WHAT HAPPENED:
Added AI-powered WhatsApp message generation and audio transcription
for call recordings.

CHANGES:

1. WHATSAPP OUTGOING MESSAGES
   - New Edge Function: generate-whatsapp-messages/index.ts
   - Generates 3 message variants via Gemini API:
     Variant 1: formal-professional
     Variant 2: friendly-warm
     Variant 3: direct-purposeful
   - MESSAGE_PURPOSES constant (follow_up, meeting_reminder, proposal_sent,
     thank_you, check_in, intro, renewal, service_update, performance_report, custom)
   - New `whatsapp_messages` table for message log
   - wa.me deep link integration (formatPhoneForWhatsApp utility)
   - UI: purpose dropdown, generate button, 3-variant cards with
     "Edit" and "Send to WhatsApp" buttons, custom message textarea,
     message history with expand/collapse

2. AUDIO TRANSCRIPTION
   - New Edge Function: transcribe-audio/index.ts
   - Uploads audio to Supabase Storage (recordings bucket)
   - Sends to Gemini API for Hebrew transcription
   - Splits output into transcript + summary
   - Hebrew-optimized prompt with speaker detection

FILES MODIFIED:
- types.ts (WhatsAppMessage interface)
- constants.ts (MESSAGE_PURPOSES)
- contexts/DataContext.tsx (WhatsApp CRUD, recording upload)
- components/ClientProfile.tsx (WhatsApp section, audio upload)
- components/LeadProfile.tsx (WhatsApp section, audio upload)
- supabase/functions/generate-whatsapp-messages/index.ts (NEW)
- supabase/functions/transcribe-audio/index.ts (NEW)

Committed: e1e83c7
Pushed to GitHub -> Vercel auto-deployed.

===============================================================================
SESSION 8 (2026-02-15) - Transcription Bug Fixes + Gemini Files API
===============================================================================

WHAT HAPPENED:
Series of fixes for audio transcription reliability. Culminated in
migrating to Gemini Files API to avoid Edge Function memory limits.

ISSUES & FIXES:
1. Improved transcription error messages with specific failure details
2. Fixed audio upload MIME type handling for M4A/MP4 files
3. Removed Hebrew characters from storage file paths (400 Bad Request)
4. Improved transcription prompt with explicit ---SUMMARY_START--- separator
5. Upgraded transcription model to gemini-2.5-flash for Hebrew quality
6. Migrated to Gemini Files API (resumable upload) to avoid Edge Function
   memory limit (error 546). Audio files now uploaded to Gemini's file
   storage first, then referenced by file_uri in the generate request.

FILES MODIFIED:
- supabase/functions/transcribe-audio/index.ts (major rewrite: Gemini Files API)
- components/ClientProfile.tsx (recording upload fixes)
- components/LeadProfile.tsx (recording upload fixes)

Commits: 5643ebc, c45cf30, d22e7bf, 83231d7, ef5a45c, de6cefd, f143444
Pushed to GitHub -> Vercel auto-deployed.

===============================================================================
SESSION 9 (2026-02-15) - AI Summaries, Inline Editing, WhatsApp Fix, Gemini Upgrade
===============================================================================

WHAT HAPPENED:
Four major items: AI Summary Notes system, inline profile editing,
WhatsApp message parsing fix, and Gemini model upgrade.

CHANGES:

1. AI SUMMARY NOTES
   - New Edge Function: generate-ai-summary/index.ts
   - Three summary types (NoteType union in types.ts):
     a) transcript_summary - structured CRM summary of call transcript
     b) recommendation_summary - distilled action items from AI recommendations
     c) proposal_focus - guidance for preparing price proposals
        (services to offer, pain points, value prop, risks, tone)
   - Summaries saved as notes with noteType + sourceId
   - UI: buttons per type in AI Summaries section, expandable cards,
     duplicate prevention (disabled if summary exists for source)
   - note_type is TEXT column, no SQL migration needed

2. INLINE PROFILE EDITING
   - Added edit modal to ClientProfile (admin-only)
   - Added edit modal to LeadProfile (admin-only)
   - Edit button in profile header opens full form modal
   - All fields editable: personal, business, services, handler, notes

3. GEMINI MODEL UPGRADE
   - Audited all 4 Gemini Edge Functions for model versions
   - Strategy chosen: gemini-3-pro-preview for quality, gemini-2.5-flash for speed
   - ai-recommendations: 2.0-flash -> 3-pro-preview + ADDED thinking-parts filter
     (was missing entirely — only read parts?.[0]?.text)
   - generate-ai-summary: 2.5-flash -> 3-pro-preview (filter already existed)
   - generate-whatsapp-messages: kept on 2.5-flash initially (speed matters)
   - transcribe-audio: stays on 2.5-flash (large token counts)

4. WHATSAPP MESSAGE FIX (4 debugging iterations)
   - Problem: "Gemini לא הצליח ליצור הודעות" error with 500 status
   - Root cause: gemini-2.5-flash thinking mode wraps ALL content in thinking
     parts for simple JSON tasks, leaving rawText empty after !part.thought filter

   Iteration 1: Added responseMimeType: 'application/json' + thinkingConfig
   -> FAILED: "Invalid JSON payload. Unknown name thinkingConfig: Cannot find field"
   Learning: responseMimeType/thinkingConfig/responseSchema NOT supported in
   gemini-2.5-flash REST API (generativelanguage.googleapis.com/v1beta)

   Iteration 2: Removed unsupported fields, kept simple config
   -> FAILED: Still empty rawText after thinking-parts filter

   Iteration 3: Changed all error responses to status 200 (so frontend can read
   JSON body), added debug field to error responses
   -> Partially helped: confirmed rawText was indeed empty (parts=X, rawLen=0)

   Iteration 4 (FINAL FIX): Switched model to gemini-2.0-flash-lite
   -> SUCCESS: No thinking parts, simple reliable JSON output
   - Also added multi-level JSON parsing fallback:
     1) Direct JSON.parse
     2) Regex extract JSON array from response
     3) Split by numbered lines as last resort

FILES MODIFIED:
- types.ts (NoteType extended with proposal_focus)
- components/ClientProfile.tsx (edit modal, AI summary buttons, proposal focus, WhatsApp debug)
- components/LeadProfile.tsx (edit modal, AI summary buttons, proposal focus)
- supabase/functions/generate-ai-summary/index.ts (NEW: 3 summary types)
- supabase/functions/ai-recommendations/index.ts (model upgrade + thinking filter)
- supabase/functions/generate-whatsapp-messages/index.ts (4 iterations: model -> 2.0-flash-lite + parsing)

Commits: 83c5840, c3080f8, c14c9b3, 9b73c62, 5c4b723
All Edge Functions redeployed.

===============================================================================
ARCHITECTURE NOTES (Updated 2026-02-15)
===============================================================================

Data Flow:
  Supabase (PostgreSQL) <-> DataContext.tsx <-> Components
  DB uses snake_case, TypeScript uses camelCase
  Transform functions handle conversion both ways

Component Structure:
  App.tsx (router + auth)
    -> Layout.tsx (sidebar + main area)
      -> [Page Components] (Dashboard, Clients, Leads, etc.)
        -> ClientProfile.tsx / LeadProfile.tsx (full CRM views)
        -> ui/ (Button, Card, Form, Modal, Badge, Table)

State Management:
  Single React Context (DataContext) holds all app state (~1100 lines)
  All CRUD operations are async with try/catch + error toast
  No external state libraries (Redux, Zustand, etc.)

Auth:
  Supabase Auth (email/password)
  Session check on App mount
  Role system: AuthContext.tsx with admin/viewer roles
  Page-level permissions (page_permissions JSON in user_roles)
  First user auto-becomes admin
  Admin creates accounts via Edge Function (no self-registration)

AI / Gemini:
  gemini-3-pro-preview -> ai-recommendations, generate-ai-summary (quality)
  gemini-2.5-flash -> transcribe-audio (speed, large token counts)
  gemini-2.0-flash-lite -> generate-whatsapp-messages (no thinking parts, reliable JSON)
  API key stored server-side only (settings.gemini_api_key)
  Thinking parts filter: if (part.text && !part.thought) — needed for 2.5+ and 3.x
  gemini-2.0-flash-lite has NO thinking parts (simpler, ideal for JSON generation)
  WARNING: responseMimeType/thinkingConfig/responseSchema NOT supported in 2.5-flash REST API
  Audio uses Gemini Files API (resumable upload -> file_uri)

Edge Functions (6 total):
  create-user -> Admin account creation
  ai-recommendations -> AI advice via Gemini 3 Pro
  generate-ai-summary -> 3 summary types via Gemini 3 Pro
  generate-whatsapp-messages -> 3 message variants via Gemini 2.0 Flash-Lite
  transcribe-audio -> Audio -> text via Gemini Files API (2.5 Flash)
  generate-proposal -> PDF via Canva Connect API

Supabase Tables:
  clients (+ assigned_to uuid)
  leads (+ created_by, assigned_to uuid)
  deals, expenses (+ is_recurring), payments
  settings (+ employee_salary, gemini_api_key, canva_api_key, canva_template_id)
  activity_log, retainer_changes
  client_notes (+ note_type, source_id)
  lead_notes (+ note_type, source_id)
  call_transcripts (client_id, lead_id, transcript, summary, recording_url)
  ai_recommendations (client_id, lead_id, recommendation)
  whatsapp_messages (client_id, lead_id, message_text, purpose, is_ai_generated)
  user_roles (user_id, email, role, display_name, page_permissions)
  storage.buckets: contracts, recordings

Styling:
  Tailwind CSS via CDN (not PostCSS build)
  Custom config in index.html <script> tag
  Dark theme: background #0B1121, surface #151e32
  Glass morphism effects throughout
  RTL: use logical properties (ms-/me- not ml-/mr-)

Key Patterns:
  - Modal z-index: z-[60] (above sidebar z-50)
  - custom-scrollbar CSS class in index.html
  - Hebrew localized dates, currency, text
  - DB row interfaces for type safety
  - safeJsonParse helper for crash-safe JSON
  - Atomic operations with rollback support
  - Confirm modals for destructive actions
  - allUsers from AuthContext for user dropdowns
  - is_admin() SECURITY DEFINER function for RLS
  - Edge Functions with service_role key for admin operations
  - Gemini thinking-parts filter in all AI functions (except 2.0-flash-lite which has none)
  - gemini-2.5-flash REST API does NOT support responseMimeType/thinkingConfig/responseSchema
  - For simple JSON generation, use gemini-2.0-flash-lite (no thinking overhead)
  - NoteType: 'manual' | 'transcript_summary' | 'recommendation_summary' | 'proposal_focus'
  - MESSAGE_PURPOSES in constants.ts for WhatsApp purpose options

GIT HISTORY (key commits):
  443c937 - Fix 19 audit issues
  [session 2 commits] - 9 features
  [session 3 commits] - theme, viewer fix, file uploads
  [session 4 commits] - retainer history, advanced roles, RLS, user sync
  6925a1a - Edge Function for admin user creation
  1085824 - Viewers can see all leads
  0c3cea1 - Enhanced client management (handler, notes, CRM view)
  89a3947 - Lead management upgrade (handler, notes, profile page)
  fd2946a - Call transcripts, AI recommendations, Canva proposals
  67f4fa4 - API keys stored server-side only
  6d6edbb - Persistent AI recommendations, expandable notes
  e1e83c7 - WhatsApp outgoing messages + AI audio transcription
  5643ebc - Improve transcription error messages
  c45cf30 - Audio upload MIME type handling
  83231d7 - Remove Hebrew chars from storage file paths
  ef5a45c - Improve transcription prompt (separator + Hebrew)
  de6cefd - Upgrade transcription to gemini-2.5-flash
  f143444 - Gemini Files API to avoid memory limit
  83c5840 - AI Summary Notes (3 types)
  c3080f8 - Inline profile editing, proposal focus, WhatsApp fix
  c14c9b3 - Gemini model upgrade + MEMORY/PROJECT docs update
  9b73c62 - Debug: detailed error logging for WhatsApp generation
  5c4b723 - Fix: switch WhatsApp to gemini-2.0-flash-lite for reliability
